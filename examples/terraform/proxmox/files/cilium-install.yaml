cluster:
  inlineManifests:
    - name: cilium-install
      contents: |
         ---
         apiVersion: rbac.authorization.k8s.io/v1
         kind: ClusterRoleBinding
         metadata:
           name: cilium-install
         roleRef:
           apiGroup: rbac.authorization.k8s.io
           kind: ClusterRole
           name: cluster-admin
         subjects:
         - kind: ServiceAccount
           name: cilium-install
           namespace: kube-system
         ---
         apiVersion: v1
         kind: ServiceAccount
         metadata:
           name: cilium-install
           namespace: kube-system
         ---
         apiVersion: batch/v1
         kind: Job
         metadata:
           name: cilium-install
           namespace: kube-system
         spec:
           backoffLimit: 10
           template:
             metadata:
               labels:
                 app: cilium-install
             spec:
               restartPolicy: OnFailure
               tolerations:
                 - operator: Exists
                 - effect: NoSchedule
                   operator: Exists
                 - effect: NoExecute
                   operator: Exists
                 - effect: PreferNoSchedule
                   operator: Exists
                 - key: node-role.kubernetes.io/control-plane
                   operator: Exists
                   effect: NoSchedule
                 - key: node-role.kubernetes.io/control-plane
                   operator: Exists
                   effect: NoExecute
                 - key: node-role.kubernetes.io/control-plane
                   operator: Exists
                   effect: PreferNoSchedule
               affinity:
                 nodeAffinity:
                   requiredDuringSchedulingIgnoredDuringExecution:
                     nodeSelectorTerms:
                       - matchExpressions:
                           - key: node-role.kubernetes.io/control-plane
                             operator: Exists
               serviceAccount: cilium-install
               serviceAccountName: cilium-install
               hostNetwork: true
               containers:
               - name: cilium-install
                 image: quay.io/cilium/cilium-cli-ci:latest
                 env:
                 - name: KUBERNETES_SERVICE_HOST
                   valueFrom:
                     fieldRef:
                       apiVersion: v1
                       fieldPath: status.podIP
                 - name: KUBERNETES_SERVICE_PORT
                   value: "6443"
                 command:
                   - cilium
                   - install
                   - --helm-set=ipam.mode=kubernetes
                   - --helm-set=kubeProxyReplacement=disabled
                   - --helm-set=securityContext.capabilities.ciliumAgent={CHOWN,KILL,NET_ADMIN,NET_RAW,IPC_LOCK,SYS_ADMIN,SYS_RESOURCE,DAC_OVERRIDE,FOWNER,SETGID,SETUID}
                   - --helm-set=securityContext.capabilities.cleanCiliumState={NET_ADMIN,SYS_ADMIN,SYS_RESOURCE}
                   - --helm-set=cgroup.autoMount.enabled=false
                   - --helm-set=cgroup.hostRoot=/sys/fs/cgroup
